\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{ThesisTemplate}

%% geometry (margins)
\usepackage{geometry}
\geometry{bindingoffset=1.75cm}
\geometry{textwidth=465pt}
\geometry{top=30mm,bottom=30mm}

%% package required
\usepackage{amsmath,amssymb}
\usepackage[dvipdfmx,dvips]{graphicx}
\usepackage[dvipdfmx]{color}

%% link settings
\PassOptionsToPackage{linkcolor=blue}{hyperref}
\PassOptionsToPackage{urlcolor=magenta}{hyperref}
\PassOptionsToPackage{citecolor=red}{hyperref}

%% title re-definition
\newcommand\leftmarkwthshape{\slshape\leftmark}
\newcommand\rightmarkwthshape{\slshape\rightmark}


%% definition of words
\newcommand{\postthesisname}{ Thesis}
\newcommand{\abstname}{\textsc{Abstract}}
\newcommand{\prephdthesisformat}{Ph.D}
\newcommand{\premasterthesisformat}{Master}
\newcommand{\prebachelorthesisformat}{Bachelor}
\newcommand{\thesisname}{\prephdthesisformat\postthesisname}

%% commands
\newcommand{\spoem}[4]{
  \begin{flushright}
  \itshape
  \small
  #1 %% Sentence

  \footnotesize
  --- #2, #3 (#4) %% author, works (year) 
  \end{flushright}
}

\newcommand{\putTitle}[1]{
  \title{\vspace*{2.5cm}
    {\Large \thesisname}\\[1zw]
    {\LARGE #1}
    \vspace{5cm}
  }
}

\newcommand{\putAuthor}[2]{
  \author{
    \Large #1\\[2ex]
    \textit{\large #2}
  }
}

\newcommand{\putAbstract}[1]{
  {
  \fontsize{11pt}{14pt}\selectfont
  %\begin{abstract}
  \chapter*{\abstractname}
    \input{#1}
  %\end{abstract}
  }
}

\newcommand{\putFigure}[4][.8]{
\begin{figure}[htbp]
    \centering
    \includegraphics[width=#1\textwidth]{figures/#2}
    \caption{#3 \label{#4}}
\end{figure}
}

\newcommand{\putTable}[4]{
  \begin{table}[htbp]
    \centering
    \caption{#3 \label{#4}}
    \begin{tabular}{#1}
      \toprule
      \expandafter#2 \\
      \bottomrule
    \end{tabular}
  \end{table} 
}

\newcommand{\AckName}{Acknowledgment}

\newcommand{\chinomp}[1][1]{\widetilde{\chi}_{#1}^{\mp}}
\newcommand{\chinopm}[1][1]{\widetilde{\chi}_{#1}^{\pm}}
\newcommand{\chinop}[1][1]{\widetilde{\chi}_{#1}^{+}}
\newcommand{\chinom}[1][1]{\widetilde{\chi}_{#1}^{-}}
\newcommand{\nino}[1][1]{\widetilde{\chi}_{#1}^{0}}
\newcommand{\wino}{\widetilde{W}}
\newcommand{\bino}{\widetilde{B}}
\newcommand{\met}{E_\mathrm{T}^\mathrm{miss}}
\newcommand{\pT}[1][p]{{#1}_\mathrm{T}}
\newcommand{\mT}[1][m]{{#1}_\mathrm{T}}
\newcommand{\dR}[1][R]{\varDelta #1}
\newcommand{\dphi}[1][\phi]{\varDelta #1}

%% redefine some variable
\renewcommand{\thefootnote}{\kern.1em{\arabic{footnote})}}
\renewcommand{\baselinestretch}{1.2}
\renewcommand{\Vec}[1]{\boldsymbol{#1}}
\newcommand{\abstractname}{\abstname}

\let\oldenumerate\enumerate
\renewcommand{\enumerate}{
  \oldenumerate
\setlength{\itemsep}{1pt}
  \setlength{\parskip}{0pt}
  \setlength{\parsep}{0pt}
}

\let\olditemize\itemize
\renewcommand{\itemize}{
    \olditemize
  \setlength{\itemsep}{1pt}
    \setlength{\parskip}{0pt}
    \setlength{\parsep}{0pt}
}

\DeclareOption{phd}{
  \renewcommand\thesisname{\prephdthesisformat\postthesisname}
}

\DeclareOption{master}{
  \renewcommand\thesisname{\premasterthesisformat\postthesisname}
}

\DeclareOption{bachelor}{
  \renewcommand\thesisname{\prebachelorthesisformat\postthesisname}
}

\def\newnumberline#1{\numberline{#1}}
\newcommand\tocchaptername{\thechapter}
\newcommand{\postchaptername}{}
\newcommand\@chapaft{\postchaptername}

\DeclareOption{japanese}{
  \renewcommand\postthesisname{論文}
  \renewcommand\abstname{概要}
  \renewcommand\contentsname{目次}
  \renewcommand\listfigurename{図目次}
  \renewcommand\listtablename{表目次}
  \renewcommand\bibname{参考文献}
  \renewcommand\chaptername{第}
  \renewcommand\postchaptername{章}
  \renewcommand\figurename{図}
  \renewcommand\tablename{表}
  \renewcommand\appendixname{付録}
  \renewcommand\prephdthesisformat{博士}
  \renewcommand\premasterthesisformat{修士}
  \renewcommand\prebachelorthesisformat{卒業}
  \renewcommand\leftmarkwthshape{\rmfamily\leftmark}
  \renewcommand\rightmarkwthshape{\rmfamily\rightmark}
  \renewcommand\newnumberline[1]{#1\ \ \ }
  \renewcommand\tocchaptername{\chaptername\thechapter\postchaptername}
  \renewcommand\chaptermark[1]{%
    \markboth {%\MakeUppercase{ %
	\ifnum \c@secnumdepth >\m@ne
	\if@mainmatter
	\@chapapp {\thechapter} \@chapaft %
	\fi
	\fi
      \ \ #1%}
    }{}
  }
  \renewcommand{\putAuthor}[2]{
    \author{
      \textit{\large #2}\\[2ex]
      \Large #1
    }
  }
  \renewcommand\sectionmark[1]{%
    \markright {%\MakeUppercase{%
	\ifnum \c@secnumdepth >\z@
	\thesection. \ %
	\fi #1
      }
    }
  \renewcommand{\AckName}{謝辞}
}

\DeclareOption{blacklink}{
  \PassOptionsToPackage{linkcolor=black}{hyperref}
  \PassOptionsToPackage{urlcolor=black}{hyperref}
  \PassOptionsToPackage{citecolor=black}{hyperref}
}
\ProcessOptions

\usepackage[dvipdfmx,bookmarkstype=toc=true,colorlinks=true,%
bookmarksnumbered=true,bookmarks=true]{hyperref}

\usepackage{pxjahyper}
\usepackage{lscape}
\usepackage{booktabs}
\usepackage{enumitem}
\usepackage{mathptmx}
\usepackage[small]{caption}
\usepackage{physics}
\usepackage{siunitx}

\usepackage[style=phys,
	    biblabel=brackets,
	    chaptertitle=false,
	    eprint=true,
	    pageranges=false,
	    defernumbers,
	    backend=biber]
	    {biblatex}
\renewbibmacro{in:}{}
\DeclareFieldFormat*{title}{\textit{``#1''}}
\DeclareFieldFormat*{citetitle}{\textit{``#1''}}

\if@twoside
  \def\ps@headings{%
      \let\@oddfoot\@empty\let\@evenfoot\@empty
      \def\@evenhead{\thepage\hfil\leftmarkwthshape}%\slshape\leftmark}%
      \def\@oddhead{\rightmarkwthshape\hfil\thepage}%{\slshape\rightmark}\hfil\thepage}%
      \let\@mkboth\markboth
    \def\chaptermark##1{%
      \markboth {\MakeUppercase{%
        \ifnum \c@secnumdepth >\m@ne
          \if@mainmatter
            \@chapapp\ \thechapter\ \@chapaft \ \ %
          \fi
        \fi
        ##1}}{}}%
    \def\sectionmark##1{%
      \markright {\MakeUppercase{%
        \ifnum \c@secnumdepth >\z@
          \thesection \ \ %
        \fi
        ##1}}}}
\else
  \def\ps@headings{%
    \let\@oddfoot\@empty
    \def\@oddhead{\rightmarkwthshape\hfil\thepage}%{\slshape\rightmark}\hfil\thepage}%
    \let\@mkboth\markboth
    \def\chaptermark##1{%
      \markright {\MakeUppercase{%
        \ifnum \c@secnumdepth >\m@ne
          \if@mainmatter
            \@chapapp\ \thechapter \ \@chapaft \ \   %
          \fi
        \fi
        ##1}}}}
\fi
\def\ps@myheadings{%
    \let\@oddfoot\@empty\let\@evenfoot\@empty
    \def\@evenhead{\thepage\hfil\leftmarkwthshape}%\slshape\leftmark}%
    \def\@oddhead{\rightmarkwthshape\hfil\thepage}%{\slshape\rightmark}\hfil\thepage}%
    \let\@mkboth\@gobbletwo
    \let\chaptermark\@gobble
    \let\sectionmark\@gobble
    }

%% Chapter re-definition
\renewcommand\chapter{\if@openright\cleardoublepage\else\clearpage\fi
                    %\thispagestyle{plain}%
                    \global\@topnum\z@
                    \@afterindentfalse
                    \secdef\@chapter\@schapter}
\def\@chapter[#1]#2{\ifnum \c@secnumdepth >\m@ne
                       \if@mainmatter
                         \refstepcounter{chapter}%
                         \typeout{\@chapapp\space\thechapter\space\@chapaft.}%
                         \addcontentsline{toc}{chapter}%
                                   {\protect\newnumberline{\tocchaptername}#1}%
                       \else
                         \addcontentsline{toc}{chapter}{#1}%
                       \fi
                    \else
                      \addcontentsline{toc}{chapter}{#1}%
                    \fi
                    \chaptermark{#1}%
                    \addtocontents{lof}{\protect\addvspace{10\p@}}%
                    \addtocontents{lot}{\protect\addvspace{10\p@}}%
                    \if@twocolumn
                      \@topnewpage[\@makechapterhead{#2}]%
                    \else
                      \@makechapterhead{#2}%
                      \@afterheading
                    \fi}
\def\@makechapterhead#1{%
  \vspace*{50\p@}%
  {\parindent \z@ \raggedright \normalfont
    \ifnum \c@secnumdepth >\m@ne
      \if@mainmatter
        \huge\bfseries \@chapapp\space \thechapter \space \@chapaft
        \par\nobreak
        \vskip 20\p@
      \fi
    \fi
    \interlinepenalty\@M
    \Huge \bfseries #1\par\nobreak
    \vskip 40\p@
  }}

\def\@schapter#1{\if@twocolumn
                   \@topnewpage[\@makeschapterhead{#1}]%
                 \else
                   \@makeschapterhead{#1}%
                   \@afterheading
                 \fi}
\def\@makeschapterhead#1{%
  \vspace*{50\p@}%
  {\parindent \z@ \raggedright
    \normalfont
    \interlinepenalty\@M
    \Huge \bfseries  #1\par\nobreak
    \vskip 40\p@
  }}

\pagestyle{headings}
